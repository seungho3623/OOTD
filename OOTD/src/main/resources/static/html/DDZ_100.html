<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Page Main</title>
    <style>
      body{
        background-image: url(img/backimg.png);
        background-size: cover;
      }
      
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
    <link href="Main.css" rel="stylesheet"> <!--/css/Main.css-->
  </head>
  <!----
  <body class="bg-primary bg-opacity-25"><!-->
  <body>
    <div style="width: 1250px;">
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>
    <header>
      <div class="flex-container flex-start">
        <div class="flex-item icon"><img src="/img/아이콘.png" width="500" height="166"><!--/img/아이콘.png--></div>
        <div class="flex-item name"><img src="/img/그림1.png" width="400" height="100" bottom="50"></div>
        <div class="flex-item weather">
          <div id="resultWeather">
            <div class="SmallWeather">
              <p></p>
            <ul class="weatherSmall"> 
              <select class="form-select" aria-label="Default select example" style="width: auto;">
                <option selected>지역</option>
                <option value="1">서울</option>
                <option value="2">부산</option>
                <option value="3">대구</option>
                <option value="4">인천</option>
                <option value="5">대전</option>
                <option value="6">광주</option>
                <option value="7">울산</option>
              </select>
            </ul>
            <ul class="SmallWeatherIMG">
            <img src="img/weather.jpg" width="50" height="50">
            </ul>
            </div>
            <div class="WeatherComent">
              <p></p>
              <p>최저기온 7도, 최고기온 14도</p>
              <p>일교차가 있어 옷 단디 입으세요</p>
            </div>
          </div>
        </div>
        <div class="flex-item color-red font4"></div>
    </div>
    </header>
    <!--
    <div id ="MainImg">
      <img src="img/아이콘.png" width="500" height="166">
    </div>
    <div id ="MainName">
        <img src="img/그림1.png" width="400" height="100" bottom="50">
      </div>
    <div id="resultWeather">
      <div class="SmallWeather">
      <ul class="weatherSmall"> 
        <select class="form-select" aria-label="Default select example" style="width: auto;">
          <option selected>지역</option>
          <option value="1">서울</option>
          <option value="2">부산</option>
          <option value="3">대구</option>
          <option value="4">인천</option>
          <option value="5">대전</option>
          <option value="6">광주</option>
          <option value="7">울산</option>
        </select>
      </ul>
      <img src="img/weather.jpg" width="50" height="50">
      </div>
    </div> -->
    <div id = "headerLine">
      <h1></h1>
    </div>
    <br><br><br><br>
    <div id = "Menu">
      <h3>설정</h3>
      <div class = "box">
        <ul class="first">
          <h4>날씨</h4>
          <form class="form-horizontal">
            <div class="form-group">
              <select id="step1" class="emptyCheck" title="시/도">
                <option id="city" value="">시/도</option>
              </select>

              <select id="step2">
                <option id="county" value="">시/군/구</option>
              </select>

              <select id="step3">
                <option id="town" value="">읍/면/동</option>
              </select>
            </div>
          </form>
        </ul>
        <ul class = "second">
          <h4>성별</h4>
          <div class ="checkbox">
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="gender" id="inlineRadio1" value="option1">
              <label class="form-check-label" for="inlineRadio1">남</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="gender" id="inlineRadio2" value="option2">
              <label class="form-check-label" for="inlineRadio2">여</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="gender" id="inlineRadio3" value="option3">
              <label class="form-check-label" for="inlineRadio3">공용</label>
            </div>
          </div>
        </ul>
        <ul class = "third">
          <h4>Style</h4>
          <div class ="checkbox1">
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="style" id="inlineRadio1" value="option1">
              <label class="form-check-label" for="inlineRadio1">캐주얼</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="style" id="inlineRadio2" value="option2">
              <label class="form-check-label" for="inlineRadio2">포멀</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="style" id="inlineRadio3" value="option3">
              <label class="form-check-label" for="inlineRadio3">홈웨어</label>
            </div>
          </div>
          <div class ="checkbox2">
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="style" id="inlineRadio1" value="option1">
              <label class="form-check-label" for="inlineRadio1">여행</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="style" id="inlineRadio2" value="option2">
              <label class="form-check-label" for="inlineRadio2">로맨틱</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="style" id="inlineRadio3" value="option3">
              <label class="form-check-label" for="inlineRadio3">스포츠</label>
            </div>
          </div>
          <div class = "fourth">
            <br>
            <!--<a href="/html/DDZA_1.html"><button type="button" class="btn btn-light" onclick="getWeather()"> 추천받기</button></a>-->
            <button type="button" class="btn btn-light" onclick="getWeather()"> 추천받기</button>
          </div>
        </ul>
      </div>
    </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js" integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N" crossorigin="anonymous"></script>
    <script>
      let cityData;
      let countyData;
      let townData;
      let dateData;
      let weatherData = {};

      window.onload = function (){
        loadArea('city');
      };

      $('#step1').change(function (){
        cityData = $('#step1').find('option:selected').text();
        loadArea('county', $(this));
      });

      $('#step2').change(function (){
        countyData = $('#step2').find('option:selected').text();
        loadArea('town', $(this));
      });

      $('#step3').change(function (){
        townData = $('#step3').find('option:selected').text();
      });

      function loadArea(type, element) {
        let value = $(element).find('option:selected').text();
        let params = {type: type, keyword: value};

        console.log(params);
        $.ajax({
          url: "/Project/weatherStep.do",
          data: params,
          dataType: "json",
          method : "post",
          success : function(res){
            if (type == 'city'){
              res.forEach(function (city) {
                $('#step1').append('<option value="'+city.areacode+'">'+city.step1+'</option>')
              });
            }
            else if(type == 'county'){
              $('#county').siblings().remove();
              $('#town').siblings().remove();
              res.forEach(function (county) {
                $('#step2').append('<option value="'+county.areacode+'">'+county.step2+'</option>')
              });
            }
            else{
              $('#town').siblings().remove();
              res.forEach(function (town) {
                $('#step3').append('<option value="'+town.areacode+'">'+town.step3+'</option>')
              });
            }
          },
          error : function(xhr){
            alert(xhr.responseText);
          }
        });
      }

      function getWeather() {
        let nullCheck = true;
        $('.emptyCheck').each(function (){
          if ('' == $(this).val()){
            alert($(this).attr('title') + "을(를) 확인바람");
            nullCheck = false;
            return false;	// 빈 값에서 멈춤
          }
        });

        if (nullCheck) {
          const today = new Date();

          let year = today.getFullYear();
          let month = ('0' + (today.getMonth() + 1)).slice(-2);
          let day = ('0' + today.getDate()).slice(-2);
          let hours = ('0' + today.getHours()).slice(-2) - 1;
          let minutes = ('0' + today.getMinutes()).slice(-2);

          dateData = year + month + day;
          let time = "0800";

          let areacode = "";
          let cityCode = $('#step1 option:selected').val();
          let countyCode = $('#step2 option:selected').val();
          let townCode = $('#step3 option:selected').val();

          if (townCode == '' && countyCode == '') {
            areacode = cityCode;
          }
          else if(townCode == '' && countyCode != '') {
            areacode = countyCode;
          }
          else if(townCode != '') {
            areacode = townCode;
          }

          let data = {"areacode" : areacode, "baseDate" : dateData, "baseTime" : time};

          $.ajax({
            url: "/Project/getWeather.do",
            data: data,
            dataType: "json",
            method : "post",
            success : function(res){
              console.log(res);
              if (res[0].resultCode != null) {
                alert(res[0].resultMsg);
              }
              else {
                let html = "";
                html += "<p>" + cityData + " " + countyData + " " + townData + "</p>";

                $("#resultWeather").empty();
                $.each(res, function(index, item){
                  switch (item.category){
                    case "TMP" :
                      html += "<p>온도 : " + item.fcstValue + "</p>";
                      break;
                    case "REH" :
                      html += "<p>습도 : " + item.fcstValue + "</p>";
                      break;
                    case "POP" :
                      html += "<p>강수 확률 : " + item.fcstValue + "</p>";
                      break;
                    case "SKY" :
                      switch (item.fcstValue){
                        case "1" :
                          html += "<p>날씨 : 맑음</p>";
                          break;
                        case "3" :
                          html += "<p>날씨 : 구름 많음</p>";
                          break;
                        case "4" :
                          html += "<p>날씨 : 흐림</p>";
                          break;
                        default : break;
                      }
                      break;
                    default : break;
                  }
                  weatherData[item.category] = item.fcstValue;
                });
                $("#resultWeather").append(html);
              }
            },
            error : function(xhr){
              alert(xhr.responseText);
            }
          });
        }
      }
    </script>
  </body>
</html>